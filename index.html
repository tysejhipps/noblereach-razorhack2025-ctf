<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NobleReach OSINT Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="text-white font-sans">
    <div id="app"></div>

    <script>
        // CONFIGURATION - Verified from your NocoDB URL
        const NOCODB_CONFIG = {
            baseUrl: 'https://app.nocodb.com',
            token: 'eozQbu5W1PBaRSAhD2NaXy_C2SuDte3xDk7egGsv',
            baseId: 'po84x0qrgw03tpo',
            tableId: 'mf7s4qbz1tmf4ne'
        };

        const icons = {
            lock: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',
            unlock: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>',
            check: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-400"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
            refresh: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>'
        };

        let state = {
            email: '',
            name: '',
            hasStarted: false,
            currentChallenge: 0,
            completedChallenges: [],
            flagInput: '',
            error: '',
            status: 'idle' // 'idle', 'submitting', 'success'
        };

        const challenges = [
            { id: 1, title: "Step 1 — The First Recruit", description: "Which organization gave rise to the Scholar?", flags: ["flag{noblereach}", "flag{noblereach_foundation}"] },
            { id: 2, title: "Step 2 — The Insider Scholar", description: "Discover which Scholar still walks among you.", flags: ["flag{tyse_hipps}", "flag{tyse}"] },
            { id: 3, title: "Step 3 — The Scholar's Footprint", description: "Decode the message hidden in the digital trace.", flags: ["flag{digital_trace}"] },
            { id: 4, title: "Step 4 — The Noble Cipher", description: "Decode the concealed instructions.", flags: ["flag{noble_cipher}"] },
            { id: 5, title: "Step 5 — The Scholar's Network", description: "Enter the secret phrase to proceed.", flags: ["flag{to_make_an_impact_for_the_public_good}"] },
            { id: 6, title: "Step 6 — The Hidden Truth", description: "Find the highlighted text in the document.", flags: ["flag{make_a_real_difference_for_the_future_of_our_country}"] }
        ];

        function saveState() {
            localStorage.setItem('noblereach_session', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('noblereach_session');
            if (saved) state = { ...state, ...JSON.parse(saved) };
        }

        function handleRestart() {
            if (confirm("This will reset all progress. Continue?")) {
                localStorage.removeItem('noblereach_session');
                window.location.reload();
            }
        }

        async function submitToNocoDB(name, email) {
            const apiUrl = `${NOCODB_CONFIG.baseUrl}/api/v2/tables/${NOCODB_CONFIG.tableId}/records`;
            
            const payload = {
                "Name": name,
                "Email": email
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'accept': 'application/json',
                    'Content-Type': 'application/json',
                    'xc-token': NOCODB_CONFIG.token
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.message || "Failed to connect to NocoDB");
            }
            return response.json();
        }

        async function handleSignup() {
            if (!state.name || !state.email) {
                state.error = "Both Name and Email are required.";
                render();
                return;
            }

            state.status = 'submitting';
            state.error = '';
            render();

            try {
                await submitToNocoDB(state.name, state.email);
                state.hasStarted = true;
                state.status = 'idle';
                saveState();
                render();
            } catch (err) {
                state.status = 'idle';
                state.error = "Error: " + err.message;
                render();
            }
        }

        function handleFlagSubmit() {
            const current = challenges[state.currentChallenge];
            const input = state.flagInput.toLowerCase().trim();
            
            if (current.flags.includes(input)) {
                state.completedChallenges.push(current.id);
                state.flagInput = '';
                state.error = '';
                
                if (state.currentChallenge < challenges.length - 1) {
                    state.currentChallenge++;
                }
                saveState();
                render();
            } else {
                state.error = "Incorrect flag. Keep searching.";
                render();
            }
        }

        function render() {
            const app = document.getElementById('app');

            if (!state.hasStarted) {
                app.innerHTML = `
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="glass-panel p-8 rounded-2xl w-full max-w-md shadow-2xl border-t-4 border-t-green-500">
                        <div class="text-center mb-8">
                            <h1 class="text-3xl font-black tracking-tighter text-white uppercase italic">NobleReach</h1>
                            <p class="text-slate-400 text-sm mt-2">OSINT CHALLENGE ENTRY</p>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase ml-1">Name</label>
                                <input type="text" id="name-in" value="${state.name}" placeholder="Agent Name" 
                                    class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:border-green-500 outline-none transition-all">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase ml-1">Email</label>
                                <input type="email" id="email-in" value="${state.email}" placeholder="Secure Email" 
                                    class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:border-green-500 outline-none transition-all">
                            </div>
                            ${state.error ? `<p class="text-red-400 text-xs bg-red-900/20 p-2 rounded border border-red-900/50">${state.error}</p>` : ''}
                            <button onclick="handleSignup()" ${state.status === 'submitting' ? 'disabled' : ''} 
                                class="w-full bg-green-600 hover:bg-green-500 disabled:opacity-50 py-4 rounded-lg font-black uppercase tracking-widest transition-all shadow-lg shadow-green-900/20">
                                ${state.status === 'submitting' ? 'Accessing Files...' : 'Initialize Mission'}
                            </button>
                        </div>
                    </div>
                </div>`;

                document.getElementById('name-in').oninput = (e) => state.name = e.target.value;
                document.getElementById('email-in').oninput = (e) => state.email = e.target.value;
                return;
            }

            app.innerHTML = `
            <div class="max-w-3xl mx-auto px-6 py-12">
                <header class="flex justify-between items-end mb-12 border-b border-slate-800 pb-6">
                    <div>
                        <p class="text-green-500 font-mono text-xs mb-1">LOGGED_IN_AS:</p>
                        <h2 class="text-2xl font-bold">${state.name}</h2>
                    </div>
                    <button onclick="handleRestart()" class="flex items-center gap-2 text-[10px] font-bold text-slate-500 hover:text-red-400 transition-colors tracking-widest uppercase">
                        ${icons.refresh} Abort Mission
                    </button>
                </header>

                <div class="space-y-4">
                    ${challenges.map((c, idx) => {
                        const isUnlocked = idx <= state.completedChallenges.length;
                        const isDone = state.completedChallenges.includes(c.id);
                        const isActive = idx === state.currentChallenge && !isDone && isUnlocked;

                        if (!isUnlocked) return '';

                        return `
                        <div class="glass-panel rounded-xl overflow-hidden transition-all ${isActive ? 'ring-2 ring-green-500' : ''}">
                            <div class="p-6">
                                <div class="flex items-center gap-4 mb-3">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center bg-slate-800 border border-slate-700">
                                        ${isDone ? icons.check : (isActive ? icons.unlock : icons.lock)}
                                    </div>
                                    <h3 class="font-bold text-lg ${isDone ? 'text-slate-500 line-through' : 'text-white'}">${c.title}</h3>
                                </div>
                                
                                ${isActive ? `
                                    <p class="text-slate-300 mb-6 leading-relaxed">${c.description}</p>
                                    <div class="flex gap-2">
                                        <input type="text" id="flag-in" placeholder="Enter Flag{...}" 
                                            class="flex-1 p-3 bg-slate-950 border border-slate-700 rounded-lg text-white outline-none focus:border-green-500">
                                        <button onclick="handleFlagSubmit()" class="bg-white text-black px-6 rounded-lg font-bold hover:bg-green-400 transition-colors">SUBMIT</button>
                                    </div>
                                    ${state.error ? `<p class="text-red-400 text-xs mt-3 font-mono">${state.error}</p>` : ''}
                                ` : ''}

                                ${isDone ? `<p class="text-green-500 text-xs font-mono uppercase tracking-widest">Clearance Level Granted</p>` : ''}
                            </div>
                        </div>`;
                    }).join('')}
                </div>
            </div>`;

            const fi = document.getElementById('flag-in');
            if (fi) {
                fi.oninput = (e) => state.flagInput = e.target.value;
                fi.onkeypress = (e) => e.key === 'Enter' && handleFlagSubmit();
                fi.focus();
            }
        }

        loadState();
        render();
    </script>
</body>
</html>
