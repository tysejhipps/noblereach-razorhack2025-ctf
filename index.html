<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NobleReach OSINT Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
            margin: 0;
        }
        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="text-white font-sans">
    <div id="app"></div>

    <script>
        // Use the exact IDs from your NocoDB URL
        const CONFIG = {
            url: 'https://app.nocodb.com/api/v2/tables/mf7s4qbz1tmf4ne/records',
            token: 'eozQbu5W1PBaRSAhD2NaXy_C2SuDte3xDk7egGsv'
        };

        let state = {
            hasStarted: false,
            name: '',
            email: '',
            currentStep: 0,
            completed: [],
            error: ''
        };

        const challenges = [
            { id: 1, title: "Step 1", desc: "Which organization gave rise to the Scholar?", flags: ["flag{noblereach}"] },
            { id: 2, title: "Step 2", desc: "Discover which Scholar still walks among you.", flags: ["flag{tyse_hipps}"] },
            { id: 3, title: "Step 3", desc: "Decode the message in the digital trace.", flags: ["flag{digital_trace}"] }
        ];

        function init() {
            const saved = localStorage.getItem('nr_state');
            if (saved) state = JSON.parse(saved);
            render();
        }

        async function startMission() {
            const n = document.getElementById('u-name').value;
            const e = document.getElementById('u-email').value;
            if (!n || !e) { state.error = "Enter details"; render(); return; }

            try {
                const res = await fetch(CONFIG.url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'xc-token': CONFIG.token },
                    body: JSON.stringify({ "Name": n, "Email": e })
                });
                if (!res.ok) throw new Error();
                state.name = n; state.email = e; state.hasStarted = true; state.error = '';
                save(); render();
            } catch (err) {
                state.error = "Connection failed. Check NocoDB.";
                render();
            }
        }

        function checkFlag() {
            const input = document.getElementById('f-in').value.toLowerCase().trim();
            if (challenges[state.currentStep].flags.includes(input)) {
                state.completed.push(challenges[state.currentStep].id);
                if (state.currentStep < challenges.length - 1) state.currentStep++;
                state.error = '';
            } else {
                state.error = "Wrong flag.";
            }
            save(); render();
        }

        function reset() { localStorage.clear(); window.location.reload(); }
        function save() { localStorage.setItem('nr_state', JSON.stringify(state)); }

        function render() {
            const app = document.getElementById('app');
            if (!state.hasStarted) {
                app.innerHTML = `
                <div class="flex items-center justify-center min-h-screen">
                    <div class="glass p-8 rounded-2xl w-80 text-center shadow-2xl">
                        <h1 class="text-2xl font-black mb-6 italic">NOBLEREACH</h1>
                        <input id="u-name" type="text" placeholder="Name" class="w-full mb-3 p-2 bg-black/40 rounded border border-white/20 outline-none">
                        <input id="u-email" type="email" placeholder="Email" class="w-full mb-3 p-2 bg-black/40 rounded border border-white/20 outline-none">
                        <p class="text-red-400 text-xs mb-3">${state.error}</p>
                        <button onclick="startMission()" class="w-full bg-green-600 p-2 rounded font-bold">START</button>
                    </div>
                </div>`;
            } else {
                app.innerHTML = `
                <div class="max-w-xl mx-auto p-10">
                    <div class="flex justify-between mb-8 border-b border-white/10 pb-4">
                        <span class="font-bold text-green-400">${state.name}</span>
                        <button onclick="reset()" class="text-xs opacity-50">RESET</button>
                    </div>
                    <div class="glass p-6 rounded-xl">
                        <h2 class="font-bold mb-2">${challenges[state.currentStep].title}</h2>
                        <p class="text-sm opacity-70 mb-4">${challenges[state.currentStep].desc}</p>
                        <div class="flex gap-2">
                            <input id="f-in" type="text" placeholder="flag{...}" class="flex-1 p-2 bg-black/40 rounded border border-white/20 outline-none">
                            <button onclick="checkFlag()" class="bg-white text-black px-4 rounded font-bold">GO</button>
                        </div>
                        <p class="text-red-400 text-xs mt-2">${state.error}</p>
                    </div>
                </div>`;
            }
        }

        init();
    </script>
</body>
</html>
