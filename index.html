<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NobleReach OSINT Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="text-white font-sans">
    <div id="app"></div>

    <script>
        const NOCODB_CONFIG = {
            baseUrl: 'https://app.nocodb.com',
            token: 'eozQbu5W1PBaRSAhD2NaXy_C2SuDte3xDk7egGsv',
            baseId: 'po84x0qrgw03tpo',
            tableId: 'mf7s4qbz1tmf4ne'
        };

        let state = {
            email: '',
            name: '',
            hasStarted: false,
            currentChallenge: 0,
            completedChallenges: [],
            error: '',
            status: 'idle'
        };

        const challenges = [
            { id: 1, title: "Step 1 — The First Recruit", description: "Which organization gave rise to the Scholar?", flags: ["flag{noblereach}", "flag{noblereach_foundation}"] },
            { id: 2, title: "Step 2 — The Insider Scholar", description: "Discover which Scholar still walks among you.", flags: ["flag{tyse_hipps}", "flag{tyse}"] },
            { id: 3, title: "Step 3 — The Scholar's Footprint", description: "Decode the message hidden in the digital trace.", flags: ["flag{digital_trace}"] },
            { id: 4, title: "Step 4 — The Noble Cipher", description: "Decode the concealed instructions.", flags: ["flag{noble_cipher}"] },
            { id: 5, title: "Step 5 — The Scholar's Network", description: "Enter the secret phrase to proceed.", flags: ["flag{to_make_an_impact_for_the_public_good}"] },
            { id: 6, title: "Step 6 — The Hidden Truth", description: "Find the highlighted text in the document.", flags: ["flag{make_a_real_difference_for_the_future_of_our_country}"] }
        ];

        function saveState() {
            localStorage.setItem('noblereach_session', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('noblereach_session');
            if (saved) state = { ...state, ...JSON.parse(saved) };
        }

        function handleRestart() {
            if (confirm("Reset all progress?")) {
                localStorage.removeItem('noblereach_session');
                window.location.reload();
            }
        }

        async function handleSignup() {
            const nameVal = document.getElementById('name-in').value;
            const emailVal = document.getElementById('email-in').value;
            
            if (!nameVal || !emailVal) {
                state.error = "Name and Email required.";
                render();
                return;
            }

            state.status = 'submitting';
            render();

            try {
                await fetch(`${NOCODB_CONFIG.baseUrl}/api/v2/tables/${NOCODB_CONFIG.tableId}/records`, {
                    method: 'POST',
                    headers: { 'accept': 'application/json', 'Content-Type': 'application/json', 'xc-token': NOCODB_CONFIG.token },
                    body: JSON.stringify({ "Name": nameVal, "Email": emailVal })
                });
                state.name = nameVal;
                state.email = emailVal;
                state.hasStarted = true;
                state.status = 'idle';
                saveState();
                render();
            } catch (err) {
                state.status = 'idle';
                state.error = "Database Error. Please try again.";
                render();
            }
        }

        function handleFlagSubmit() {
            const inputEl = document.getElementById('flag-in');
            const input = inputEl.value.toLowerCase().trim();
            const current = challenges[state.currentChallenge];
            
            if (current.flags.includes(input)) {
                state.completedChallenges.push(current.id);
                state.error = '';
                if (state.currentChallenge < challenges.length - 1) {
                    state.currentChallenge++;
                }
                saveState();
                render();
            } else {
                state.error = "Incorrect flag.";
                render();
            }
        }

        function render() {
            const app = document.getElementById('app');

            if (!state.hasStarted) {
                app.innerHTML = `
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="glass-panel p-8 rounded-2xl w-full max-w-md shadow-2xl border-t-4 border-t-green-500 text-center">
                        <h1 class="text-3xl font-black mb-6 italic uppercase tracking-widest">NobleReach</h1>
                        <div class="space-y-4 text-left">
                            <input type="text" id="name-in" placeholder="Full Name" class="w-full p-3 bg-slate-900 border border-slate-700 rounded-lg text-white outline-none focus:border-green-500">
                            <input type="email" id="email-in" placeholder="Email Address" class="w-full p-3 bg-slate-900 border border-slate-700 rounded-lg text-white outline-none focus:border-green-500">
                            ${state.error ? `<p class="text-red-400 text-xs">${state.error}</p>` : ''}
                            <button onclick="handleSignup()" class="w-full bg-green-600 py-3 rounded-lg font-bold uppercase tracking-widest">
                                ${state.status === 'submitting' ? 'Verifying...' : 'Start Mission'}
                            </button>
                        </div>
                    </div>
                </div>`;
                return;
            }

            app.innerHTML = `
            <div class="max-w-3xl mx-auto px-6 py-12">
                <div class="flex justify-between items-center mb-10 border-b border-slate-800 pb-6">
                    <h2 class="text-xl font-bold text-green-400">${state.name}</h2>
                    <button onclick="handleRestart()" class="text-xs text-slate-500 hover:text-red-400 uppercase font-bold">Abort</button>
                </div>

                <div class="space-y-6
